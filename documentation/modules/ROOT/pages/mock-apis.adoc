:imagesdir: ../assets/images

= Setting up mocks to help with parallel development

Now that the OpenAPI specs are finalised, creation of API mocks will enable parallel development streams leading to rapid inner loop development. 

* The various  dev teams (such as mobile dev) do not need to wait for the APIs to be completely developed and instead can use these mocks to get realistic responses. 
* Backend developers in parallel build the backend applications APIs using modern cloud-native frameworks such as https://quarkus.io/[Quarkus^, window=product-page]. 

There are a number of ways to mock APIs including microcks, postman etc. In this labs you will use hosted Postman.

== Goals of this lab
* Setup Postman as a tool to mock the APIs using the OpenAPI schema
* Import one of the APIs 
* Test the imported API using the mock server and look for the change made to one of the examples in the API Designer

== Setup Postman
. Access Postman at link:https://www.postman.com/[postman^, window=postman]. Click on *Sign Up for Free*.
. You can now either create a new user or sign-up with Google. 
+
image::postman-signup.png[]
 
. You can provide your name and other details after signing in if prompted. You may choose the `Skip for now` button.
. You will be prompted with a welcome screen asking   *How would you like to start?*  if this is the first time you are logging in. You can ignore this prompt by using the `_<esc>_` key on your keyboard.

. From the top navbar you can choose an alternate Workspace or choose to create a new one or you may remain in your current workspace.
+
image::choose-workspace.png[]


== Import the Product Catalog API

. Click on the *Import* button as show in the screenshot below
+
image::import-button-workspace.png[]

. You will be presented with an import wizard popup
+
image:postman-drag-file.png[width=60%]



. The next step is to import the OpenAPI spec from Service Registry.  Navigate to the https://console.redhat.com/beta/application-services/service-registry[Service Registry^,window=service-registry]. Login with your Red Hat account if necessary.
. Navigate to the `globex` instance and from there to `globex / ProductCatalogAPI`. 
. You can retrieve OpenAPI spec through one of the following options and proceed to import the spec into Postman either as *Raw Text* or as *File import*. Both of these options are describe below. +

.*Option 1: Import OpenAPI spec as raw text*
[%collapsible]
====
* In the Service Registry browser tab, click on the *Content* tab. Copy the specifications content shown in this page into the memory (`Ctrl-A` and `Ctrl-C`).
+
image::osr-view-content.png[]

* Navigate to the Postman window browser tab which is already open.

* Paste the copied content into the popup in the field as indicated below
+
image::postman-paste-text.png[width=60%] 

* You will be auto navigated to the next step.
====


.*Option 2: Import OpenAPI spec as file*
[%collapsible]
====
* In the Service Registry browser tab, click on the *Documentation* tab. Click on the *Download* button. Make a note of where the file is downloaded on your laptop.
+
image::osr-documentation-download.png[]


* Navigate back to the Postman window browser tab where you have the *Import* wizard open.

* You can either drag the file into this window or the `select files or folders` options to import the file downloaded from Service Registry
+
image:postman-drag-file.png[width=60%]

* You will be auto-navigated to the next step.
====

[start=6]
. Once you have successfully imported the OpenAPI specification, you will next be asked to *Choose how to import your API*. 
. Choose the `OpenAPI 3.0 with a Postman Collection` option, and then choose to  *View Import Settings* link as highlighted below

+
image::postman-how-to-import-api.png[width=60%]


. Within the `Import Settings` wizard, for the *Parameter generation* dropdown  choose the value as `Example`. Click on the <- button to go back to the previous section
+
image::postman-import-settings.png[width=60%]


. Click on *Import*. 
+
image::postman-import-api.png[width=60%]

. You will be notified that import is complete.
+
image::postman-import-complete.png[width=60%]

. Explore the `Product Catalog API` that has been imported that can be viewed under "Collections" section on the left hand navigation
. Note that the *Collections* and *APIs* sections are prepopulated

== Setup Postman mock server
. The next step is to setup a mock server on Postman which will then showcase how it can be useful for developers while the actual API backend is still under developement.
. Click on *Mock Servers* on the left-hand navigation, and choose the *Create Mock Server* option.
+
image::postman-mock-landing.png[]
. On the right pane, choose *Select an existing collection*, and then choose `ProductCatalogAPI`
+
image:postman-mock-chooseapi.png[]
. Give the mock server a name, for example `ProductCatalog Mock Server` and click on *Create Mock Server* at the bottom of the page.
+
image::postman-mock-create-server.png[]

. You will be shown details of the mock server URL. Make a note of the URL.
+
image::postman-mock-server-url.png[]

== Test the imported API using the mock server
. Explore *Collections* menu from the left-hand side, and you will be able to see the examples that have been already created while the API was designed.
. Click on the `Get list of product by id` from the `Product Catalog API`. This opens a tab on Postman which you can use to issue a request.
+
image::postman-choose-prodbyid.png[] 

. Replace the following parameters and click *Send*.
** `{{baseUrl}}` in the address field with the Mock server's URL
** `{{:ids}}` in the address field with `329299`

. You can view the list of products in the bottom panel. Note that the name of the Quarkus T-shirt now says `Jaya's Awesome Quarkus T-shirt` (or the name you have for this product)
+
image::postman-choose-prodbyid-response.png[]

. These mock end point of the  mock server can be used by the dev teams that are dependent on the APIs, to continue development in parallel without having to wait for the backend services to be fully developed, thereby accelerating time to market.

In the next step, you will learn to protect the API by using Red Hat OpenShift API Management. 
